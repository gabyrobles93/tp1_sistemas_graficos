<!doctype html>
<html>
    <head>
        <title> TP 1 </title>
        <style>
            canvas{ background-color: grey; }
        </style>
    
        <script type="text/javascript" src="js/gl-matrix.js"></script>
        <script type="text/javascript" src="js/webgl-utils.js"></script>
        <script src="js/jquery-1.11.2.min.js"></script>
        <script src="js/jquery.mousewheel.min.js"></script>
        <script type="text/javascript" src="js/utils.js"></script>
        <script type="text/javascript" src="js/IO_handle.js"></script>
        <script type="text/javascript" src="Object3D/inheritPrototype.js"></script>
        <script type="text/javascript" src="Object3D/Object3D.js"></script>
        <script type="text/javascript" src="Object3D/Sphere.js"></script>
        <script type="text/javascript" src="WebGLApp.js"></script>

        <!--
        \*****************************************************************************/
            VERTEX SHADER
        \*****************************************************************************/
        -->
        <script id="shader-vs" type="x-shader/x-vertex">

            precision highp float;

            attribute vec3 aVertexPosition;
            attribute vec3 aVertexNormal;

            uniform mat4 modelMatrix;            
            uniform mat4 viewMatrix;
            uniform mat4 projMatrix;
            uniform mat3 normalMatrix;

            varying vec3 vNormal;    
            varying vec4 vPosWorld;  

            void main(void) {
                vPosWorld = viewMatrix * modelMatrix * vec4(aVertexPosition, 1.0);
                gl_Position = projMatrix * vPosWorld;

                vNormal = normalize(normalMatrix * normalize(aVertexNormal));                              
            }
        </script>
        <!--
        \*****************************************************************************/
            FRAGMENT SHADER
        \*****************************************************************************/
        -->
        <script id="shader-fs" type="x-shader/x-fragment">
            precision highp float;
            varying vec3 vNormal;
            varying vec4 vPosWorld;

            void main(void) {

                vec3 lightVec=normalize(vec3(0.0,3.0,5.0)-vPosWorld.xyz);
                vec3 diffColor=mix(vec3(0.7,0.7,0.7),vNormal,0.4);
                vec3 color=dot(lightVec,vNormal)*diffColor+vec3(0.2,0.2,0.2);

               gl_FragColor = vec4(color,1.0);
            }
        </script>
        <!--
        \*****************************************************************************/
            INIT GL
        \*****************************************************************************/
        -->
        <script type="text/javascript">
        
        var gl = null;
        var canvas = null;
        var shaderProgram;

        function initGL(canvas) {
            try {
                gl = canvas.getContext("webgl");
                gl.viewportWidth = canvas.width;
                gl.viewportHeight = canvas.height;
            } catch (e) {
            }
            if (!gl) {
                alert("Could not initialise WebGL");
            }
        } 

        function initShaders() {
            //get shader source
            var fs_source = document.getElementById('shader-fs').innerHTML,
                vs_source = document.getElementById('shader-vs').innerHTML;

            //compile shaders    
            vertexShader = makeShader(vs_source, gl.VERTEX_SHADER);
            fragmentShader = makeShader(fs_source, gl.FRAGMENT_SHADER);
            
            //create program
            shaderProgram = gl.createProgram();
            
            //attach and link shaders to the program
            gl.attachShader(shaderProgram, vertexShader);
            gl.attachShader(shaderProgram, fragmentShader);
            gl.linkProgram(shaderProgram);

            if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {
                alert("Unable to initialize the shader program.");
            }
            
            //use program
            gl.useProgram(shaderProgram);

            shaderProgram.vertexPositionAttribute = gl.getAttribLocation(shaderProgram, "aVertexPosition");
            gl.enableVertexAttribArray(shaderProgram.vertexPositionAttribute);

            shaderProgram.vertexNormalAttribute = gl.getAttribLocation(shaderProgram, "aVertexNormal");
            gl.enableVertexAttribArray(shaderProgram.vertexNormalAttribute);

            shaderProgram.modelMatrixUniform = gl.getUniformLocation(shaderProgram, "modelMatrix");
            shaderProgram.viewMatrixUniform = gl.getUniformLocation(shaderProgram, "viewMatrix");
            shaderProgram.projMatrixUniform = gl.getUniformLocation(shaderProgram, "projMatrix");
            shaderProgram.normalMatrixUniform = gl.getUniformLocation(shaderProgram, "normalMatrix");
        }

        function makeShader(src, type){
            //compile the vertex shader
            var shader = gl.createShader(type);
            gl.shaderSource(shader, src);
            gl.compileShader(shader);

            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                console.log("Error compiling shader: " + gl.getShaderInfoLog(shader));
            }
            return shader;
        }
        
        </script>
    </head>
    
    <body onload="webGLStart();">

    	<center>    		            
            <canvas id="canvas" width="1280" height="1024">
            	Your browser does not support the HTML5 canvas element.
    		</canvas>    		
    	</center>

    </body>
</html>
